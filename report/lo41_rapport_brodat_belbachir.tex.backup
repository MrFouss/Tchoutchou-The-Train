\documentclass[a4paper,12pt]{article}

\usepackage{prettylatex}
\usepackage{titlepage}

\top{Université de Technologie de Belfort-Montbéliard}{}
\title{Gestion des voies ferroviaires}{Projet de LO41}
\author{Maxime \textsc{Brodat} \\ Esia \textsc{Belbachir}}
\date{Semestre de printemps 2016}

\begin{document}

\maketitlepage

\tableofcontents
\pagebreak

\neverindent

\section{Fonctionnement global}

Le programme fonctionne de la manière suivante : I prend en argument un nom de fichier contenant la liste des trains à lancer dans le système et lit ce fichier comme une partition. Au terme du programme, tous les trains doivent avoir passé le réseau de chemins de fer.

\subsection{3 processus}

\subsubsection{Main}

Le processus main est celui qui va lancer tous les autres processus et s'occuper de la terminaison du programme. Notamment, il s'occupe du processus train, du processus manager, et de la gestion des interruption (SIGINT) à l'échelle du programme entier.

\subsubsection{Train}

C'est le processus train qui va être responsable de lire le fichier des trains et de gérer le comportement de chaque train. Ce processus se compose d'une tread par train et de la thread principale qui encadre les autres.

\subsubsection{Manager}

Le processus manager est responsable des décisions d'aiguillage des trains dans le sytème. Il est composé d'une thread principale et de 3 thread secondaires aiguillage 1, aiguillage 2 et tunnel. Chacune des 3 threads secondaire est responsable de l'authorisation de passage des trains sur leur zone critique.

\subsection{Initialisation, interruption et terminaison}

Si l'initialisation du programme se déroule normalement (pas d'interruption extérieure), le processus principal récupère le nom du fichier de trains à lire, rattache un handler particuler pour les signaux SIGINT (voire paragraphe suivant), crée une file de message (communication inter-processus), crée les processus manager et train et se met en attente du processus train.

Lorsque le processus train se termine (tous les trains sont passés), celui-ci se termine de lui même. Le processus principal est alors chargé d'envoyer un signal d'interruption au processus manager qui va alors se terminer proprement. Enfin, la file de message inter-processus est supprimée et le programme se termine.

Le programme est capable de gérer les interruptions (SIGINT) envoyées au processu main et de terminer le programme sans qu'il y ai de fuite mémoire. Le processus main est équipé d'un handler de SIGINT qui s'occupe de propager l'information d'interruption aux processus manager et train sous forme de signaux SIGINT. Ensuite, le programme se termine de la même manière qui s'il n'y avait pas eu d'unterruption (attente des processus train et manager, et suppression de la file de message inter-processus).

\subsection{Communication inter-processus}

Les thread du processus train et les threads du processus manager ont besoin de communiquer entre elles pour coordonner les passages de train. Cette communication se met en place sous forme d'une file de message.

Un message contient un destinataire (identifiant du message), une source, un type et des données sur le train lorsque celui-ci est la source du message. Les train ont des identifiants supérieurs ou égaux à 10 car les idientifiant de 1 à 9 sont réservés pour des threads particulières qui requièrent des valeurs statiques (aiguillage 1, aiguillage 2 et tunnel par exemple ont les identifiants 1, 2, et 3).

\section{Le processus train}

\subsection{Initialisation, interruption et terminaison}

Le processus train prend en argument le nom du fichier de trains à lire. Il va ensuite mettre en place un handler pour SIGINT qui permettra de libérer toutes les ressources qui alloue avant de se terminer en cas d'interruption. Ensuite, il initialise un Parser qui permet de lire, train par train, les caractéritiques des trains qui doivent être envoyées dans le système. Afin de conserver les identifiants des threads de trains qui vont être lancées, un tableau est alloué à la taille indiquée par le Parser. Ensuite, chaque train est lancée au moment indiqué dans le fichier (voire paragraphe suivant). Si une erreur de lecture se produit, le train qui était alors en train d'être lancé est abandonné et le programme passe directement au train suivant.

Le fichier se compose de la manière suivante :
\begin{itemize}
	\item 1er ligne : <nombre de trains n>
	\item n lignes suivantes : <moment du lancement> <type de train> <sens de circulation>
\end{itemize}
Le moment du lancement du train correpond à un nombre de secondes après le début du programme. Les trains doivent être classés dans leur ordre de lancement (moments de lancements croissants).

Lorsque tous les trains sont lancées, la thread principale du processus train se met en attente de toutes ses threads de trains ou d'un signal d'interruption SIGINT. Si un signal SIGINT est reçu, une SIGNAL SIGNTERM est envoyé à toutes les threads de trains.

\subsection{Les threads du processus train}

Chaque thread de train a un comportement prédéfini en fonction de son type (Marchandise, Grande Ligne ou TGV). Cependant, on trouve des comportements communs entre tous les trains :
\begin{itemize}
	\item Tous les trains sont considérés comme en dehors du sytème à leur démarrage. Il doivent recevoir une autorisation de la zone critique la plus proche pour entrer dans le système.
	\item Les trains sont arrêtés par défaut. Il n'avance que lorsqu'ils ont recu une autorisation.
	\item Lorsqu'un train arrive aux abord d'une zone critique, il s'arrête et envoit une requete à la zone critique en question au travers de la file de message inter-processus.
\end{itemize}


\section{Le processus manager}

\subsection{Initialisation, interruption et terminaison}

\subsection{Les threads du processus manager}

\subsubsection{La réception des messages}

\subsubsection{Résolution des messages}


\section{Améliorations possibles}

Actuellement, les processus ne bloquent jamais les signaux. Il pourrait être intéressant d'ignorer les SIGINT par exemple pendant les phases d'initialisation et de terminaison des processus pour assurer une meilleure sécurité.
\end{document}
